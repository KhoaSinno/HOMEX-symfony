{% extends 'baseAdmin.html.twig' %}

{% block title %}Th√™m m·ªõi l·ªãch cho b√°c sƒ©

{% endblock %}

{% block body %}
	<!-- Page Wrapper -->
	<div class="page-wrapper">
		<div
			class="content container-fluid">

			<!-- Page Header -->
			<div class="page-header">
				<div class="row">
					<div class="col-sm-7 col-auto">
						<h3 class="page-title">T·∫°o l·ªãch l√†m vi·ªác</h3>
						<ul class="breadcrumb">
							<li class="breadcrumb-item">
								<a href="">Dashboard</a>
							</li>
							<li class="breadcrumb-item active">T·∫°o l·ªãch l√†m vi·ªác</li>
						</ul>
					</div>
				</div>
			</div>
			<!-- /Page Header -->
			<div class="mb-2">
				<a class="btn btn-sm btn-warning rounded mr-2" href="javascript:history.back();" title="Tr·ªü v·ªÅ">
					<i class="fa fa-arrow-left" aria-hidden="true"></i>
					Tr·ªü v·ªÅ</a>
			</div>

			{{ include('admin/schedule_work/_form.html.twig') }}

		</div>
	</div>

{% endblock %}

{% block JSCustom %}
	<script>

$(document).ready(function () {
    let slotsContainer = $(".time-slot-container");
    let ajaxRequest = null; // Bi·∫øn ƒë·ªÉ l∆∞u request AJAX hi·ªán t·∫°i

    $('#schedule_work_slotDuration').on('change', function () {
        let duration = $(this).val();

    if (duration === "all") {
            // N·∫øu ch·ªçn "T·∫•t c·∫£ th·ªùi gian", reload l·∫°i trang
            location.reload();
        }

        // üîπ L∆∞u l·∫°i danh s√°ch c√°c time slot ƒë√£ ch·ªçn tr∆∞·ªõc khi g·ªçi API
        let selectedSlots = [];
        $('.time-slot-container input:checked').each(function () {
            selectedSlots.push($(this).val());
        });

        // N·∫øu c√≥ request tr∆∞·ªõc ƒë√≥, h·ªßy n√≥
        if (ajaxRequest !== null) {
            ajaxRequest.abort();
        }

        ajaxRequest = $.ajax({
            url: "{{ path('generate_time_slots_create') }}",
            method: "POST",
            data: { duration: duration },
            beforeSend: function () {
                console.log("‚è≥ ƒêang t·∫£i...");
                slotsContainer.html("<p>‚è≥ ƒêang t·∫£i khung gi·ªù...</p>");
            },
            success: function (response) {
                console.log("‚úÖ API Response:", response);

                slotsContainer.empty();

                response.timeSlots.forEach(function (slot, index) {
                    let isChecked = selectedSlots.includes(slot) ? "checked" : ""; // üîπ Gi·ªØ l·∫°i tr·∫°ng th√°i ch·ªçn

                    let slotHtml = `
                        <div class="time-slot-item">
                            <input type="checkbox" id="schedule_work_timeSlots_${index}" name="schedule_work[timeSlots][]" value="${slot}" ${isChecked}>
                            <label for="schedule_work_timeSlots_${index}">${slot}</label>
                        </div>
                    `;
                    slotsContainer.append(slotHtml);
                });

                console.log("üìù Time Slots in Form:", $(".time-slot-container").html());
            },
            error: function (xhr, status) {
                if (status !== "abort") {
                    alert("‚ùå L·ªói khi l·∫•y Time Slots!");
                }
            },
            complete: function () {
                ajaxRequest = null;
            }
        });
    });

    // üõ† C·∫≠p nh·∫≠t danh s√°ch tr∆∞·ªõc khi submit
    $('form').on('submit', function () {
        let selectedSlots = [];
        $('.time-slot-container input:checked').each(function () {
            selectedSlots.push($(this).val());
        });

        $("#hidden_timeSlots").val(JSON.stringify(selectedSlots));
    });
});


    {# $(document).ready(function () {
        let slotsContainer = $(".time-slot-container");

        $('#schedule_work_slotDuration').on('change', function () {
            let duration = $(this).val();

            $.ajax({
        url: "{{ path('generate_time_slots_create') }}",
        method: "POST",
        data: { duration: duration },
        success: function (response) {
            console.log("‚úÖ API Response:", response); // Ki·ªÉm tra d·ªØ li·ªáu nh·∫≠n ƒë∆∞·ª£c

            let slotsContainer = $(".time-slot-container");
            slotsContainer.empty();

            response.timeSlots.forEach(function (slot, index) {
                let slotHtml = `
                    <div class="time-slot-item">
                        <input type="checkbox" id="schedule_work_timeSlots_${index}" name="schedule_work[timeSlots][]" value="${slot}">
                        <label for="schedule_work_timeSlots_${index}">${slot}</label>
                    </div>
                `;
                slotsContainer.append(slotHtml);
            });

            console.log("üìù Time Slots in Form:", $(".time-slot-container").html()); // Ki·ªÉm tra danh s√°ch trong DOM
        },
        error: function () {
            alert("‚ùå L·ªói khi l·∫•y Time Slots!");
        }
    });

        });

        // üõ† C·∫≠p nh·∫≠t danh s√°ch tr∆∞·ªõc khi submit
        $('form').on('submit', function () {
            let selectedSlots = [];
            $('.time-slot-container input:checked').each(function () {
                selectedSlots.push($(this).val());
            });

            $("#hidden_timeSlots").val(JSON.stringify(selectedSlots));
        });
    }); #}



   {# $(document).ready(function () {
    $('#schedule_work_slotDuration').on('change', function () {
        let duration = $(this).val();

        console.log("Thay ƒë·ªïi s·ªë ph√∫t kh√°m:", duration);

        $.ajax({
            url: "{{ path('generate_time_slots_create') }}", // Route Symfony g·ªçi API
            method: "POST",
            data: { duration: duration },
            success: function (response) {
                console.log("API ph·∫£n h·ªìi:", response); // Debug API response

                let slotsContainer = $(".time-slot-container");
                slotsContainer.empty(); // X√≥a khung gi·ªù c≈©

                response.timeSlots.forEach(function (slot, index) {
                    let slotHtml = `
                        <div class="time-slot-item">
                            <input type="checkbox" id="schedule_work_timeSlots_${index}" name="schedule_work[timeSlots][]" value="${slot}">
                            <label for="schedule_work_timeSlots_${index}">${slot}</label>
                        </div>
                    `;
                    slotsContainer.append(slotHtml);
                });
            },
            error: function () {
                alert("C√≥ l·ªói x·∫£y ra khi l·∫•y Time Slots!");
            }
        });
    });
}); #}



{# older #}
{# $(document).ready(function () {
    $('#schedule_work_slotDuration, #schedule_work_doctor, #schedule_work_date').on('change', function () {
        let duration = $(this).val();
        let selectedDate = $('#schedule_work_date').val();
        let doctorId = $('#schedule_work_doctor').val();

        if (!doctorId || !selectedDate) return;

        $.ajax({
            url: "{{ path('generate_time_slots') }}",
            method: "POST",
            data: { duration: duration, date: selectedDate, doctorId: doctorId },
            success: function (response) {
                let slotsContainer = $(".time-slot-container");
                slotsContainer.empty(); // X√≥a khung gi·ªù c≈©

                response.timeSlots.forEach(function (slot, index) {
                    let slotHtml = `
                        <div class="time-slot-item">
                            <input type="checkbox" id="schedule_work_timeSlots_${index}" name="schedule_work[timeSlots][]" value="${slot}">
                            <label for="schedule_work_timeSlots_${index}">${slot}</label>
                        </div>
                    `;
                    slotsContainer.append(slotHtml);
                });
            },
            error: function () {
                alert("L·ªói khi l·∫•y Time Slots!");
            }
        });
    });
}); #}

</script>
{% endblock %}