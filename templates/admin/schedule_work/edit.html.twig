{% extends 'baseAdmin.html.twig' %}

{% block title %}
	C·∫≠p nh·∫≠t l·ªãch l√†m vi·ªác
{% endblock %}

{% block body %}
	<!-- Page Wrapper -->
	<div class="page-wrapper">
		<div
			class="content container-fluid">

			<!-- Page Header -->
			<div class="page-header">
				<div class="row">
					<div class="col-sm-7 col-auto">
						<h3 class="page-title">T·∫°o l·ªãch l√†m vi·ªác</h3>
						<ul class="breadcrumb">
							<li class="breadcrumb-item">
								<a href="">Dashboard</a>
							</li>
							<li class="breadcrumb-item active">T·∫°o l·ªãch l√†m vi·ªác</li>
						</ul>
					</div>
					<div class="col-sm-5 col">
						<a href="{{ path('app_create_schedule') }}" class="btn btn-primary float-right mt-2">Th√™m m·ªõi</a>
					</div>
				</div>
			</div>
			<!-- Page Header -->

			<div class="mb-2">
				<a class="btn btn-sm btn-warning rounded mr-2" href="javascript:history.back();" title="Tr·ªü v·ªÅ">
					<i class="fa fa-arrow-left" aria-hidden="true"></i>
					Tr·ªü v·ªÅ</a>
			</div>

			{{ include('admin/schedule_work/_form.html.twig', {'button_label': 'Update'}) }}

			{# {{ include('admin/schedule_work/_delete_form.html.twig') }} #}
		</div>
	</div>

{% endblock %}


{% block JSCustom %}
<script>
    $(document).ready(function () {
        let doctorId = "{{ doctorId }}"; // üî• Nh·∫≠n doctorId t·ª´ Twig
		let date = "{{ date }}"; // üî• Nh·∫≠n date t·ª´ Twig
        $('#schedule_work_slotDuration').on('change', function () {
            let duration = $(this).val();
			if (duration === "all") {
						// N·∫øu ch·ªçn "T·∫•t c·∫£ th·ªùi gian", reload l·∫°i trang
						location.reload();
					}
            $.ajax({
                url: "{{ path('generate_time_slots_edit') }}",
                method: "POST",
                data: { duration: duration, doctorId: doctorId, date: date }, // üî• G·ª≠i doctorId sang Controller
                success: function (response) {
                    console.log("API ph·∫£n h·ªìi:", response);
					console.log("Danh s√°ch timeSlots:", response.timeSlots);
                    let slotsContainer = $(".time-slot-container");
                    slotsContainer.empty();

                   /** response.timeSlots.forEach(function (slot, index) {
                        let isChecked = slot.checked ? 'checked' : '';
                        let slotHtml = `
                            <div class="time-slot-item">
                                <input type="checkbox" id="schedule_work_timeSlots_${index}" name="schedule_work[timeSlots][]" value="${slot.time}" ${isChecked}>
                                <label for="schedule_work_timeSlots_${index}">${slot.time}</label>
                            </div>
                        `;
                        slotsContainer.append(slotHtml);
                    });
					*/
						
					response.timeSlots.forEach(function (slot, index) {
					let checkedAttr = slot.checked ? 'checked' : ''; // N·∫øu checked: true th√¨ t√≠ch s·∫µn

					let slotHtml = `
						<div class="time-slot-item">
							<input type="checkbox" id="schedule_work_timeSlots_${index}" 
								name="schedule_work[timeSlots][]" 
								value="${slot.time}" ${checkedAttr}>
							<label for="schedule_work_timeSlots_${index}">${slot.time}</label>
						</div>
					`;
					slotsContainer.append(slotHtml);
				});
                },
                error: function () {
                    alert("C√≥ l·ªói x·∫£y ra khi l·∫•y Time Slots!");
                }
            });
        });
    });
</script>

<!-- Moment.js (C·∫ßn thi·∫øt cho datetimepicker) -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>

	<!-- Bootstrap Datetimepicker -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker.min.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/js/bootstrap-datetimepicker.min.js"></script>

<script>
		$(document).ready(function () {
		console.log("DOM Loaded, initializing datetimepicker...");

		// C·∫•u h√¨nh Moment.js ƒë·ªÉ tu·∫ßn b·∫Øt ƒë·∫ßu t·ª´ Th·ª© Hai
		moment.updateLocale('vi', {
		week: {
		dow: 1
		} // dow: 1 => Tu·∫ßn b·∫Øt ƒë·∫ßu t·ª´ Th·ª© Hai
		});

		$('.schedule-datepicker').datetimepicker({
		format: 'DD/MM/YYYY', // ƒê·ªãnh d·∫°ng ng√†y
		locale: 'vi', // Ti·∫øng Vi·ªát (c·∫ßn moment.js)
		showTodayButton: true, // Hi·ªÉn th·ªã n√∫t "H√¥m nay"
		useCurrent: false, // Kh√¥ng t·ª± ƒë·ªông ch·ªçn ng√†y hi·ªán t·∫°i
		sideBySide: true, // Hi·ªÉn th·ªã gi·ªù/ph√∫t c·∫°nh nhau
		toolbarPlacement: 'top', // V·ªã tr√≠ toolbar
		showClear: true, // Hi·ªÉn th·ªã n√∫t "X√≥a"
		showClose: true, // Hi·ªÉn th·ªã n√∫t "ƒê√≥ng"
		defaultDate: new Date()
		});
		});
	</script>
	
{% endblock %}